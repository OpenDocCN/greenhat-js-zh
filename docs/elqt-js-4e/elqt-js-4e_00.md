## 第一章：引言

这是一本关于指导计算机的书。如今，计算机和螺丝刀一样常见，但它们要复杂得多，让它们按照你的想法运行并不总是容易的。

如果你要给计算机的任务是常见且容易理解的，比如查看你的电子邮件或充当计算器，你可以打开相应的应用程序并开始工作。但对于独特或开放式的任务，往往没有合适的应用程序。

这就是编程可能发挥作用的地方。`编程`是构建一个`程序`的行为——一组精确的指令，告诉计算机该做什么。由于计算机是愚蠢的、迂腐的动物，编程在根本上是乏味和令人沮丧的。

幸运的是，如果你能克服这一事实——甚至享受以愚蠢机器能够处理的方式进行思考的严谨——编程是有回报的。它使你能够在几秒钟内完成手动操作需要`永远`才能完成的事情。它是让你的计算机工具完成之前无法做到的事情的一种方式。此外，它还成为了解决难题和抽象思维的美妙游戏。

大多数编程都是使用编程语言进行的。`编程语言`是一种人工构造的语言，用于指导计算机。值得注意的是，我们与计算机沟通的最有效方式在很大程度上借鉴了我们彼此之间沟通的方式。像人类语言一样，计算机语言允许将单词和短语以新方式组合，使得表达不断新的概念成为可能。

曾几何时，以语言为基础的接口，比如`1980`年代和`1990`年代的`BASIC`和`DOS`提示符，是与计算机互动的主要方式。对于常规计算机使用，这些接口在很大程度上已被视觉界面取代，视觉界面更易于学习，但自由度较低。但是如果你知道在哪里寻找，语言依然存在。其中之一，`JavaScript`，内置于每个现代网页浏览器中，因此几乎在每个设备上都可用。

本书将努力使你对这门语言足够熟悉，以便能够用它做一些有用且有趣的事情。

### 关于编程

除了解释`JavaScript`，我还将介绍编程的基本原则。事实证明，编程是困难的。基本规则简单明了，但基于这些规则构建的程序往往变得复杂到引入自己的规则和复杂性。在某种程度上，你是在构建自己的迷宫，而你很容易在其中迷失。

阅读这本书时，你可能会感到非常沮丧。如果你是编程新手，很多新材料需要消化。这些材料会以`结合`的方式呈现，要求你建立额外的联系。

你必须付出必要的努力。当你努力跟上书中的内容时，不要急于得出关于自己能力的结论。你很好——你只需要坚持下去。休息一下，重新阅读一些材料，确保你阅读并理解示例程序和练习。学习是艰苦的工作，但你所学的一切都是你的，并将使进一步的学习变得更容易。

`当行动变得无利可图时，收集信息；当信息变得无利可图时，休息。`

—厄休拉·K·勒古恩，`《黑暗的左手》`

程序有许多方面。它是程序员输入的文本，是驱动计算机执行操作的指令力量，是计算机内存中的数据，同时，它也控制着在该内存上执行的操作。试图将程序与熟悉的物体进行比较的类比往往显得苍白无力。一个表面上看似合适的比较是将程序比作机器——涉及许多独立的部分，要使整个系统运作，我们必须考虑这些部分如何相互连接并对整体操作做出贡献。

计算机是一个物理机器，充当这些无形机器的宿主。计算机本身只能做一些非常简单的事情。它们之所以如此有用，是因为它们以极高的速度完成这些事情。一个程序可以巧妙地组合大量这些简单的动作，从而做出非常复杂的事情。

程序是一种思想的构建。构建是没有成本的，它是无重量的，并且在我们打字的手下容易增长。但是随着程序的增长，其复杂性也在增加。编程的技能是构建不会让程序员感到困惑的程序的技能。最好的程序是在保持易于理解的同时能够做一些有趣的事情。

一些程序员认为，这种复杂性最好通过在他们的程序中使用一小组经过充分理解的技术来管理。他们制定了严格的规则（“最佳实践”），规定程序应该具有的形式，并且他们小心翼翼地待在他们安全的小区域内。

这不仅无聊——而且无效。新问题通常需要新解决方案。编程领域年轻且仍在迅速发展，足够多样化以容纳截然不同的方法。在程序设计中有许多可怕的错误，你应该至少尝试犯一次，这样你才能理解它们。对优秀程序的感知是通过实践发展出来的，而不是通过一份规则清单来学习的。

### 为什么语言很重要

在计算的初始阶段，并不存在编程语言。程序的样子大致是这样的：

```js
00110001 00000000 00000000
00110001 00000001 00000001
00110011 00000001 00000010
01010001 00001011 00000010
00100010 00000010 00001000
01000011 00000001 00000000
01000001 00000001 00000001
00010000 00000010 00000000
01100010 00000000 00000000
```

这是一个将数字从`1`加到`10`

当然，手动输入这些晦涩的位模式（即零和一）确实让程序员有一种强大巫师的深刻感受。这在工作满足感上一定是值得的。

上一个程序的每一行都包含一条指令。它可以用英语这样写：

1.  在内存位置`0`存储数字`0`。

1.  在内存位置`1`存储数字`1`。

1.  将内存位置`1`的值存储到内存位置`2`。

1.  从内存位置`2`的值中减去数字`11`。

1.  如果内存位置`2`的值是数字`0`，继续执行指令`9`。

1.  将内存位置`1`的值加到内存位置`0`。

1.  将数字`1`加到内存位置`1`的值上。

1.  继续执行指令`3`。

1.  输出内存位置`0`的值。

尽管这已经比位的混合更加可读，但仍然相当模糊。使用名称而不是数字作为指令和内存位置会有所帮助。

```js
  Set "total" to 0.
  Set "count" to 1.
[loop]
  Set "compare" to "count".
  Subtract 11 from "compare".
  If "compare" is 0, continue at [end].
  Add "count" to "total".
  Add 1 to "count".
  Continue at [loop].
[end]
  Output "total".
```

你能看到程序此时是如何工作的吗？前两行给两个内存位置赋予了初始值：`total`将用于构建计算结果，而`count`将跟踪我们当前查看的数字。使用`compare`的行可能是最令人困惑的。程序想要检查`count`是否等于`11`，以决定是否可以停止运行。因为我们的假设机器相当原始，所以它只能测试一个数字是否为零，并基于此做出决定。因此，它使用标记为`compare`的内存位置来计算`count - 11`的值，并根据该值做出决定。接下来的两行将`count`的值加到结果中，并在程序决定`count`还不是`11`时每次将`count`增加`1`。

这是相同程序的`JavaScript`版本：

```js
let total = 0, count = 1;
while (count <= 10) {
  total += count;
  count += 1;
}
console.log(total);
// → 55
```

这个版本给我们带来了一些改进。最重要的是，我们不再需要指定程序要如何来回跳转——`while`结构解决了这个问题。只要给定的条件成立，它就会继续执行下面的代码块（用大括号括起来）。这个条件是`count <= 10`，这意味着“计数小于或等于`10`。”我们不再需要创建一个临时值并将其与零进行比较，这只是一个无趣的细节。编程语言的一部分强大之处在于，它们可以为我们处理这些无趣的细节。

在程序结束时，当`while`结构完成后，使用`console.log`操作来输出结果。

最后，如果我们恰好有方便的操作`range`和`sum`可用，分别用于创建一个范围内的数字集合和计算一组数字的总和，程序可能看起来像这样：

```js
console.log(sum(range(1, 10)));
// → 55
```

这个故事的寓意是同一个程序可以用长短不同、可读和不可读的方式表达。程序的第一个版本极为晦涩，而最后一个版本几乎是英文：记录从`1`到`10`的数字范围的总和。（我们将在后面的章节中看到如何定义像`sum`和`range`这样的操作。）

一种好的编程语言通过让程序员以更高的层次谈论计算机必须执行的操作来帮助他们。它帮助省略细节，提供方便的构建模块（例如`while`和`console.log`），允许你定义自己的构建模块（例如`sum`和`range`），并使这些模块易于组合。

### 什么是`JavaScript`？

`JavaScript`于1995年推出，作为一种向`Netscape Navigator`浏览器的网页添加程序的方式。此后，这种语言被所有其他主要图形网页浏览器所采纳。它使现代网页应用成为可能——也就是说，这些应用可以让你直接互动，而无需每次操作都重新加载页面。`JavaScript`还用于更传统的网站，以提供各种形式的互动性和巧妙性。

重要的是要注意，`JavaScript`与名为`Java`的编程语言几乎没有关系。相似的名称是出于营销考虑而非明智的判断。当`JavaScript`被引入时，`Java`语言正受到强力推广并日益流行。有人认为借助这一成功的想法不错。现在我们被这个名称困住了。

在`Netscape`之外被采纳后，编写了一份标准文档，描述`JavaScript`语言应该如何工作，以便那些声称支持`JavaScript`的各种软件可以确保它们实际提供的是同一种语言。这被称为`ECMAScript`标准，以进行标准化的`Ecma International`组织命名。在实践中，`ECMAScript`和`JavaScript`这两个术语可以互换使用——它们是同一种语言的两个名称。

有人会说`可怕`的关于`JavaScript`的事情。这些话中很多都是事实。当我第一次被要求用`JavaScript`写东西时，我很快开始厌恶它。它几乎接受我输入的任何内容，但以一种完全不同于我意图的方式解读。这当然与我当时对自己在做什么毫无头绪有很大关系，但这里确实存在一个问题：`JavaScript`在其允许的范围上极为宽松。这个设计理念是为了让初学者更容易进行`JavaScript`编程。实际上，这主要让你在程序中找到问题变得更加困难，因为系统不会直接指出它们。

然而，这种灵活性也有其优点。它为更灵活语言中不可能实现的技术留出了空间，并形成了一种愉快的非正式编程风格。在正确学习这门语言并使用一段时间后，我实际上开始`喜欢`上`JavaScript`。

`JavaScript`经历了多个版本。`ECMAScript`版本3是在2000年至2010年间`JavaScript`崛起时得到广泛支持的版本。在此期间，版本4的雄心勃勃的开发正在进行，计划对语言进行一系列激进的改进和扩展。然而，以如此激进的方式改变一个生动且被广泛使用的语言，结果在政治上是困难的，因此版本4的工作在2008年被放弃。一个雄心较小的版本5于2009年发布，仅进行了一些不具争议性的改进。2015年，版本6发布，这是一个重要更新，包括了一些计划在版本4中的理念。从那时起，我们每年都有新的小更新。

`JavaScript`的演变意味着浏览器必须不断跟上。如果你使用的是较旧的浏览器，它可能不支持所有功能。语言设计者非常小心，不做任何可能破坏现有程序的更改，因此新浏览器仍然可以运行旧程序。在本书中，我使用的是2024版的`JavaScript`。

网络浏览器并不是唯一使用`JavaScript`的平台。一些数据库，例如`MongoDB`和`CouchDB`，将`JavaScript`作为其脚本和查询语言。多个桌面和服务器编程平台，最显著的是`Node.js`项目（见第二十章），提供了在浏览器外编程`JavaScript`的环境。

### `代码`及其用途

`代码`是构成程序的文本。本书的大多数章节都包含了相当多的`代码`。我相信阅读`代码`和编写`代码`是学习编程不可或缺的部分。尽量不要只是匆匆浏览示例——要认真阅读并理解它们。起初这可能会很慢且令人困惑，但我保证你很快就会掌握其中的窍门。练习题也是如此。在你真正写出一个有效的解决方案之前，不要假设你理解它们。

我建议你在实际的`JavaScript`解释器中尝试练习题的解答。这样，你可以立即得到反馈，看看你所做的是否有效，并且我希望你会被诱惑去实验，超越练习。

在本书中运行示例代码最简单的方法——也是进行实验的方法——是在[`eloquentjavascript.net`](https://eloquentjavascript.net)的在线版本中查找它。你可以单击任何代码示例进行编辑和运行，并查看它产生的输出。要进行练习，请访问[`eloquentjavascript.net/code`](https://eloquentjavascript.net/code)，该网站提供每个编码练习的起始代码，并允许你查看解决方案。

在本书的网站之外运行本书定义的程序需要小心。许多示例可以独立运行，并且应该在任何`JavaScript`环境中工作。但后面的章节中的代码通常是为特定环境（浏览器或`Node.js`）编写的，只能在那里运行。此外，许多章节定义了更大的程序，其中的代码片段彼此依赖或依赖外部文件。网站上的沙盒提供链接到包含运行特定章节所需的所有脚本和数据文件的`ZIP`文件。

### 本书概述

本书大致分为三个部分。前12章讨论`JavaScript`语言。接下来的七章则讲述网页浏览器以及如何使用`JavaScript`对其进行编程。最后，两章专门讲解`Node.js`，另一个编写`JavaScript`的环境。本书中有五个`项目章节`描述了更大的示例程序，让你体验实际编程。

本书的语言部分以四个章节开始，介绍`JavaScript`语言的基本结构。它们讨论控制结构（例如你在本介绍中看到的`while`语句）、函数（编写自己的构建块）和数据结构。在这些之后，你将能够编写基本程序。接下来，第五章和第六章介绍了使用函数和对象编写更`抽象`代码并控制复杂性的技巧。

在第一项目章节构建一个简单的送货机器人后，本书的语言部分继续探讨错误处理和修复、正则表达式（处理文本的重要工具）、模块化（抵御复杂性的另一种手段）以及异步编程（处理耗时事件）。第二个项目章节实现了一种编程语言，结束了本书的第一部分。

本书的第二部分，第十三章到第十九章，描述了浏览器`JavaScript`可访问的工具。你将学习如何在屏幕上显示内容（第十四章和第十七章）、响应用户输入（第十五章）以及通过网络进行通信（第十八章）。在这一部分还有两个`项目章节`，构建一个平台游戏和一个像素画程序。

第二十章描述了`Node.js`，第二十一章则使用该工具构建一个小网站。最后，第二十二章讨论了优化`JavaScript`程序以提高速度时需要考虑的一些事项。

### 排版约定

在本书中，以等宽字体书写的文本将代表程序的元素。有时这些是自足的片段，有时它们只是引用了附近程序的一部分。程序（你已经见过一些）书写如下：

```js
function factorial(n) {
  if (n == 0) {
    return 1;
  } else {
    return factorial(n - 1) * n;
  }
}
```

有时，为了显示程序产生的输出，预期的输出会在其后面写出，前面加上两个斜杠和一个箭头。

```js
console.log(factorial(8));
// → 40320
```

祝好运！
