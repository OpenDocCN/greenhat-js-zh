# 第二章：值、类型和运算符

在计算机的世界中，只有数据。你可以读取数据、修改数据、创建新数据——但不能提及非数据的东西。所有这些数据都以长序列的位存储，因此从根本上说是相似的。

`比特`是任何一种二值事物，通常被描述为零和一。在计算机内部，它们的形式可以是高电压或低电压、电信号强或弱，或者在`CD`表面上光亮或暗淡的点。任何离散信息都可以简化为零和一的序列，因此可以用比特表示。

例如，我们可以用比特表示数字`13`。这与十进制数字的工作方式相同，但我们只有`2`个不同的数字，而每个数字的权重从右到左增加一个`2`的倍数。以下是构成数字`13`的比特，以及它们下面显示的数字权重：

```js
   0   0   0   0   1   1   0   1
 128  64  32  16   8   4   2   1
```

那是二进制数`00001101`。它的非零数字代表`8`、`4`和`1`，总和为`13`。

### 值

想象一下位的海洋——一个庞大的位的海洋。典型的现代计算机在其易失性数据存储（工作内存）中有超过`1000`亿个比特。非易失性存储（硬盘或同类设备）往往要多几个数量级。

为了能够处理如此数量的比特而不迷失，我们将它们分成表示信息块的块。在`Java-Script`环境中，这些块被称为`值`。虽然所有值都是由比特构成的，但它们扮演不同的角色。每个值都有一个确定其角色的类型。有些值是数字，有些值是文本片段，有些值是函数，等等。

要创建

本章的剩余部分介绍`Java-Script`程序的原子元素——也就是简单值类型和可以作用于这些值的运算符。

### 数字

`number`类型的值，毫无疑问，是数字值。在`Java-Script`程序中，它们的书写方式如下：

```js
13
```

在程序中使用这个会导致数字`13`的比特模式在计算机的内存中产生。

`JavaScript`使用固定数量的位数，`64`位，来存储单个数字值。用`64`位可以组合的模式有限，这限制了可以表示的不同数字的数量。用`N`个十进制数字，你可以表示`10^(N)`个数字。类似地，给定`64`个二进制位，你可以表示`2^64`个不同的数字，大约是`18`个`quintillion`（后面有`18`个零的`18`）。这非常庞大。

计算机内存曾经小得多，人们通常使用`8`位或`16`位的组合来表示数字。意外的`溢出`小数字很容易发生——即得到一个无法适应给定位数的数字。如今，即便是口袋里的计算机内存也非常充裕，所以你可以自由使用`64`位，而只有在处理真正庞大的数字时才需担心溢出。

然而，并非所有小于`18 quintillion`的整数都能适应`JavaScript`数字。这些位还存储负数，所以有一位用于指示数字的符号。更大的问题是表示非整数。为此，一些位被用于存储小数点的位置。实际上，能存储的最大整数更接近`9`万亿（`15`个零）——这仍然是相当巨大的。

分数用小数点表示。

```js
9.81
```

对于非常大或非常小的数字，你还可以通过添加`e`（代表`指数`）及数字的指数来使用科学记数法。

```js
2.998e8
```

这就是`2.998 × 10^8 = 299,800,000`。

对于小于前述`9`万亿的整数（也称为`整数`）进行的计算，确保始终是精确的。遗憾的是，分数计算通常并非如此。正如`π`（圆周率）无法用有限的十进制数字精确表示，许多数字在仅有`64`位可用存储时会失去一些精度。这虽然令人遗憾，但在特定情况下才会引发实际问题。重要的是要意识到这一点，并将分数字符视为近似值，而非精确值。

#### `算术`

数字的主要操作是算术。算术运算如加法或乘法需要两个数字值，并生成一个新数字。以下是在`JavaScript`中的表示方式：

```js
100 + 4 * 11
```

`+`和`*`符号称为`运算符`。第一个表示加法，第二个表示乘法。在两个值之间放置一个运算符将对这些值应用它，并生成一个新值。

这个例子是指“将`4`和`100`相加，然后将结果乘以`11`”，还是乘法在加法之前进行？正如你可能猜到的，乘法优先进行。与数学一样，你可以通过将加法用括号括起来来改变这一点。

```js
(100 + 4) * 11
```

对于减法，有`-`运算符。除法可以使用`/`运算符。

当操作符没有括号一起出现时，它们的应用顺序由操作符的`优先级`决定。示例显示乘法优先于加法。`/`操作符与`*`操作符具有相同的优先级。同样，`+`和`-`也具有相同的优先级。当多个具有相同优先级的操作符并排出现时，如`1 - 2 + 1`，它们是从左到右应用的：`(1 - 2) + 1`。

不必过于担心这些优先级规则。如果有疑问，只需添加括号。

还有一个算术操作符，你可能不会立即认出来。`%`符号用于表示`余数`操作。`X % Y`是将`X`除以`Y`的余数。例如，`314 % 100`产生`14`，`144 % 12`结果为`0`。余数操作符的优先级与乘法和除法相同。你也会经常看到这个操作符被称为`模`。

#### `特殊数字`

在`JavaScript`中，有三个特殊值被视为数字，但它们的行为不同于正常数字。前两个是`Infinity`和`-Infinity`，表示正无穷和负无穷。`Infinity - 1`仍然是`Infinity`，依此类推。不过，不要过于相信基于无穷的计算。它在数学上并不严谨，并且很快会导致下一个特殊数字：`NaN`。

`NaN`代表“不是一个数字”，尽管它`是`数字类型的一个值。当你尝试计算`0 / 0`（零除以零）、`Infinity - Infinity`或其他一些没有意义的数字运算时，你会得到这个结果。

### 字符串

下一个基本数据类型是`字符串`。字符串用于表示文本。它们通过用引号括起内容来书写。

```js
`Down on the sea`
"Lie on the ocean"
'Float on the ocean'
```

你可以使用反引号、双引号或单引号来标记字符串，只要字符串开头和结尾的引号匹配。

你几乎可以在引号之间放入任何内容，让`JavaScript`将其转换为字符串值。但有些字符比较困难。你可以想象在引号之间放置引号可能会很麻烦，因为它们看起来像是字符串的结束。`换行`（当你按下`ENTER`时得到的字符）只能在用反引号（`` ` ``）引起来的字符串中包含。

为了能够在字符串中包含这些字符，使用以下表示法：在引号文本中，反斜杠（`\`）表示后面的字符具有特殊含义。这称为`转义`字符。前面有反斜杠的引号不会结束字符串，而是成为字符串的一部分。当`n`字符出现在反斜杠后面时，它被解释为换行。同样，反斜杠后面的`t`表示制表符。考虑以下字符串：

```js
"This is the first line\nAnd this is the second"
```

这是该字符串中的实际文本：

```js
This is the first line
And this is the second
```

当然，有时你希望字符串中的反斜杠仅仅是反斜杠，而不是特殊代码。如果两个反斜杠相连，它们将合并在一起，结果字符串值中只会剩下一个。这就是字符串`“换行字符的写法是“`\n`。”`的表达方式：

```js
"A newline character is written like \"\\n\"."
```

字符串同样需要被建模为一系列位，以便能够存在于计算机中。JavaScript 这样做的方式是基于`Unicode`标准。该标准为几乎每个你可能需要的字符分配一个数字，包括希腊文、阿拉伯文、日文、亚美尼亚文等等。如果我们为每个字符都有一个数字，那么字符串可以用一串数字来描述。这就是 JavaScript 所做的。

不过有一个复杂性：JavaScript 的表示法使用每个字符串元素 16 位，这可以描述多达 2¹⁶ 个不同的字符。然而，Unicode 定义的字符数量超过这个限制——目前大约是其两倍。因此，一些字符，比如许多表情符号，在 JavaScript 字符串中占用两个“字符位置”。我们将在第五章中回到这个问题。

字符串不能被除、乘或减。`+`操作符`可以`用于它们，不是用于相加，而是用于`连接`——将两个字符串粘合在一起。以下行将产生字符串“concatenate”：

```js
"con" + "cat" + "e" + "nate"
```

字符串值有多个相关的函数（`方法`），可以用来对它们执行其他操作。我将在第四章中详细说明这些。

用单引号或双引号写的字符串行为非常相似；唯一的区别在于你需要转义的引号类型。反引号引起来的字符串，通常称为`模板字面量`，可以做一些更多的技巧。除了能够跨越多行外，它们还可以嵌入其他值。

```js
`half of 100 is ${100 / 2}`
```

当你在`模板字面量`中写入`${}`内的内容时，其结果将被计算、转换为字符串，并包含在该位置。这个例子产生的字符串是“100 的一半是 50”。

### 一元操作符

并非所有操作符都是符号。有些是用单词书写的。一个例子是`typeof`操作符，它会生成一个字符串值，指明你提供的值的类型。

```js
console.log(typeof 4.5)
// → number
console.log(typeof "x")
// → string
```

我们将在示例代码中使用`console.log`来指示我们想要查看某个表达式的计算结果。（更多内容将在下一章讨论。）

本章迄今为止显示的其他操作符都作用于两个值，但`typeof`只接受一个。使用两个值的操作符称为`二元`操作符，而只接受一个的称为`一元`操作符。减号操作符（`-`）可以同时作为二元操作符和一元操作符使用。

```js
console.log(- (10 - 2))
// → -8
```

### 布尔值

通常情况下，有一个值用来区分只有两个可能性是很有用的，比如“是”和“否”或“开”和“关”。为此，JavaScript 有一个`布尔`类型，它只有两个值：`true`和`false`，以这两个词书写。

#### `比较`

这是生成布尔值的一种方式：

```js
console.log(3 > 2)
// → true
console.log(3 < 2)
// → false
```

> 和`<`符号分别是“更大于”和“更小于”的传统符号。它们是二元运算符。应用它们的结果是一个布尔值，指示它们在此情况下是否成立。

字符串可以以相同的方式进行比较。

```js
console.log("Aardvark" < "Zoroaster")
// → true
```

字符串的排序方式大致上是字母顺序，但并不是你在字典中预期看到的那样：大写字母总是“少于”小写字母，因此`"Z"` < `"a"`，而且非字母字符（！、- 等）也包含在排序中。在比较字符串时，JavaScript 从左到右逐个比较字符的 Unicode 代码。

其他类似的运算符有`>=`（大于或等于）、`<=`（小于或等于）、`==`（等于）和`!=`（不等于）。

```js
console.log("Garnet" != "Ruby")
// → true
console.log("Pearl" == "Amethyst")
// → false
```

在 JavaScript 中，唯一一个不等于自身的值是`NaN`（“不是一个数字”）。

```js
console.log(NaN == NaN)
// → false
```

`NaN`用于表示无意义计算的结果，因此它不等于任何`其他`无意义计算的结果。

#### `逻辑运算符`

还有一些操作可以直接应用于布尔值本身。JavaScript 支持三种逻辑运算符：`与`、`或`和`非`。这些可以用来对布尔值进行“推理”。

`&&`运算符表示逻辑`与`。它是一个二元运算符，仅当给它的两个值都为真时，其结果才为真。

```js
console.log(true && false)
// → false
console.log(true && true)
// → true
```

`||`运算符表示逻辑`或`。如果给它的任何值为真，它的结果就是`true`。

```js
console.log(false || true)
// → true
console.log(false || false)
// → false
```

`非`（Not）写作感叹号（`！`）。它是一个一元运算符，反转给它的值——`!true`产生`false`，而`!false`产生`true`。

在将这些布尔运算符与算术和其他运算符混合时，并不总是明显需要括号。在实践中，你通常可以知道到目前为止我们看到的运算符中，`||`的优先级最低，然后是`&&`，接下来是比较运算符（`>`、`==`等），最后是其他。这种顺序的选择旨在使以下典型表达式中尽可能少地需要括号：

```js
1 + 1 == 2 && 10 * 10 > 50
```

我们要看的最后一个逻辑运算符是非一元、非二元，而是`三元`，操作三个值。它的写法是用一个问号和一个冒号，如下所示：

```js
console.log(true ? 1 : 2);
// → 1
console.log(false ? 1 : 2);
// → 2
```

这个被称为`条件`运算符（有时简称为`三元运算符`，因为它是该语言中唯一的此类运算符）。该运算符使用问号左侧的值来决定“选择”哪两个值中的一个。如果你写`a ? b : c`，当`a`为真时结果为`b`，否则为`c`。

### 空值

两个特殊值，写作`null`和`undefined`，用于表示缺少`有意义`的值。它们本身是值，但不携带任何信息。

语言中许多不产生有意义值的操作会产生`undefined`，仅仅因为它们必须产生`某个`值。

`undefined`和`null`之间的意义差异是JavaScript设计的一个意外，大多数情况下这并不重要。在你需要关注这些值的情况下，我建议将它们视为大致可互换的。

### `自动类型转换`

在介绍中，我提到JavaScript不遗余力地接受几乎任何你给它的程序，甚至是做奇怪事情的程序。以下表达式很好地展示了这一点：

```js
console.log(8 * null)
// → 0
console.log("5" - 1)
// → 4
console.log("5" + 1)
// → 51
console.log("five" * 2)
// → NaN
console.log(false == 0)
// → true
```

当运算符应用于“错误”的类型值时，JavaScript会悄悄地将该值转换为所需的类型，使用的一套规则通常不是你想要或期望的。这被称为`类型强制转换`。第一个表达式中的`null`变成`0`，第二个表达式中的`"5"`变成`5`（从字符串到数字）。然而在第三个表达式中，`+`在进行数字相加之前会尝试字符串拼接，因此`1`被转换为`"1"`（从数字到字符串）。

当某个值在明显意义上无法映射为数字（例如`"five"`或`undefined`）时，被转换为数字后会得到`NaN`。对`NaN`的进一步算术操作仍然会产生`NaN`，因此如果你在意想不到的地方遇到这种情况，请检查是否发生了意外的类型转换。

当使用`==`运算符比较相同类型的值时，结果是容易预测的：如果两个值相同，你应该得到`true`，除了`NaN`的情况。但是，当类型不同，JavaScript会使用一套复杂而混乱的规则来决定如何处理。在大多数情况下，它只是尝试将其中一个值转换为另一个值的类型。然而，当运算符两侧有`null`或`undefined`时，只有在两侧都是`null`或`undefined`之一时才会返回`true`。

```js
console.log(null == undefined);
// → true
console.log(null == 0);
// → false
```

这种行为通常很有用。当你想测试一个值是否具有实际的值而不是`null`或`undefined`时，可以用`==`或`!=`运算符将其与`null`进行比较。

如果你想测试某个东西是否确切指向`false`值呢？像`0 == false`和`"" == false`这样的表达式也为真，因为自动类型转换。当你`不`希望发生任何类型转换时，还有两个额外的运算符：`===`和`!==`。第一个测试一个值是否`精确`等于另一个，第二个测试是否不精确等于。因此，`"" === false`是`false`，正如预期的那样。

我建议防御性地使用三字符比较运算符，以防止意外的类型转换让你困扰。但当你确信两侧的类型将相同时，使用较短的运算符没有问题。

#### `逻辑运算符的短路`

逻辑运算符`&&`和`||`以一种特殊的方式处理不同类型的值。它们会将左侧的值转换为布尔类型以决定如何操作，但根据运算符和转换结果，它们会返回`原始`的左侧值或右侧值。

例如，`||`运算符将在左侧的值可以转换为`true`时返回该值，否则返回右侧的值。当值为布尔值时，这具有预期效果，对其他类型的值也做类似处理。

```js
console.log(null || "user")
// → user
console.log("Agnes" || "user")
// → Agnes
```

我们可以利用这个功能作为回退到默认值的一种方式。如果你有一个可能为空的值，可以在其后加上`||`和替代值。如果初始值可以转换为`false`，你将得到替代值。将字符串和数字转换为布尔值的规则规定，`0`、`NaN`和空字符串（`""`）视为`false`，而其他所有值都视为`true`。这意味着`0 || -1`产生`-1`，`"" || “!？”`得`“！？”`。

`??`运算符与`||`类似，但仅在左侧的值为`null`或`undefined`时返回右侧的值，而不是其他可以转换为`false`的值。通常，这比`||`的行为更可取。

```js
console.log(0 || 100);
// → 100
console.log(0 ?? 100);
// → 0
console.log(null ?? 100);
// → 100
```

`&&`运算符类似，但方向相反。当左侧的值是转换为`false`的东西时，它返回该值，否则返回右侧的值。

这两个运算符的另一个重要特性是，它们右侧的部分只有在必要时才会被计算。在`true || X`的情况下，无论`X`是什么——即使它是一个做一些`可怕`事情的程序——结果将为`true`，`X`从不被计算。`false && X`也是如此，它是`false`并将忽略`X`。这被称为`短路评估`。

条件运算符的工作方式类似。第二和第三个值中，只有被选择的那个会被计算。

### 摘要

在本章中，我们查看了四种类型的 JavaScript 值：数字、字符串、布尔值和未定义值。这些值可以通过输入其名称（`true`、`null`）或值（`13`、`"abc"`）来创建。

你可以使用运算符组合和转换值。我们看到的二元运算符包括算术运算（`+`、`-`、`*`、`/`和`%`）、字符串连接（`+`）、比较（`==`、`!=`、`===`、`!==`、`<`、`>`、`<=`、`>=`）以及逻辑运算（`&&`、`||`、`??`），还有几个一元运算符（`-`用于取反一个数字，`!`用于逻辑取反，以及`typeof`用于查找值的类型）和一个三元运算符`(?:)`用于根据第三个值选择两个值中的一个。

这为你提供了足够的信息来将 JavaScript 用作口袋计算器，但仅此而已。下一章将开始将这些表达式结合成基本程序。

`在我薄薄的、半透明的皮肤下，我的心脏闪耀着亮红色，他们不得不给我注射 10cc 的 JavaScript 才能让我恢复。（我对血液中的毒素反应良好。）天啊，那东西会让你的腮帮子嗓子都冒桃子！`

—`为何，Why’s (Poignant) Guide to Ruby`

![图片](img/f0022-01.jpg)
